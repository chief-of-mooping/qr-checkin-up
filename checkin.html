<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏¥‡∏™‡∏¥‡∏ï ‡∏°.‡∏û‡∏∞‡πÄ‡∏¢‡∏≤</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 40px;
        }
        
        .status-card {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        
        .status-card.loading {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .status-card.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .status-card.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .status-card.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .login-section {
            text-align: center;
            margin: 30px 0;
        }
        
        .login-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .login-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
        }
        
        .login-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .user-info h3 {
            color: #2c5aa0;
            margin-bottom: 15px;
        }
        
        .user-info p {
            margin: 8px 0;
            color: #666;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .btn-home {
            background: #6c757d;
            color: white;
        }
        
        .btn-home:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .checkin-btn {
            background: #28a745;
            color: white;
            font-size: 16px;
            padding: 15px 30px;
            margin: 20px 0;
        }
        
        .checkin-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .checkin-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 20px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .content {
                padding: 20px;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p>122334 ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå‡∏≠‡∏¥‡πÄ‡∏•‡∏Ñ‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</p>
        </div>
        
        <div class="content">
            <div id="statusMessage" class="status-card loading">
                <div class="spinner" style="margin: 0 auto 10px;"></div>
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
            </div>
            
            <div id="loginSection" class="login-section" style="display: none;">
                <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p style="margin: 15px 0; color: #666;">‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ Google ‡∏Ç‡∏≠‡∏á‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ (@up.ac.th)</p>
                <button id="loginBtn" class="login-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google
                </button>
            </div>
            
            <div id="userSection" style="display: none;">
                <div class="user-info">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> <span id="userName"></span></p>
                    <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> <span id="userEmail"></span></p>
                    <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï:</strong> <span id="studentId"></span></p>
                </div>
                
                <div style="text-align: center;">
                    <button id="checkinBtn" class="btn checkin-btn">
                        ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                    </button>
                </div>
            </div>
            
            <div class="nav-buttons">
                <a href="home.html" class="btn btn-home">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        // Firebase configuration - Config ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const firebaseConfig = {
            apiKey: "AIzaSyDeD73Yg2QhPXl0dD40uvCsVejpf38OYeY",
            authDomain: "qr-checkin-up.firebaseapp.com",
            projectId: "qr-checkin-up",
            storageBucket: "qr-checkin-up.firebasestorage.app",
            messagingSenderId: "780428257804",
            appId: "1:780428257804:web:31b68ff043623144679c29"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
        provider.setCustomParameters({
            hd: 'up.ac.th'
        });

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏¥‡∏™‡∏¥‡∏ï (‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å PDF)
        const studentList = {
            "65011610": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏Å‡∏£‡∏°‡∏ó‡∏≠‡∏á", "email": "65011610@up.ac.th" },
            "65011621": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏ó‡∏ß‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏™‡∏•‡∏µ‡∏≠‡πà‡∏≠‡∏ô", "email": "65011621@up.ac.th" },
            "65011632": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏±‡∏ô‡∏ß‡∏≤ ‡∏™‡∏ß‡∏¢‡∏Ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß", "email": "65011632@up.ac.th" },
            "65011643": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏£‡∏¥‡∏ô‡∏ó‡∏£ ‡πÅ‡∏î‡∏á‡∏à‡∏µ‡∏ô", "email": "65011643@up.ac.th" },
            "65011665": { "name": "‡∏ô‡∏≤‡∏¢‡∏ß‡∏±‡∏ä‡∏£‡∏û‡∏á‡∏©‡πå ‡∏≠‡∏¥‡∏ô‡∏ï‡πä‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "email": "65011665@up.ac.th" },
            "65011687": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏¥‡∏£‡∏¥‡∏Å‡∏£ ‡∏ò‡∏¥‡πÅ‡∏Å‡πâ‡∏ß", "email": "65011687@up.ac.th" },
            "65011698": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì‡∏≤ ‡∏õ‡∏•‡∏∑‡πâ‡∏°‡∏Ñ‡∏ì‡∏∞", "email": "65011698@up.ac.th" },
            "65012464": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏†‡∏±‡∏™‡∏£‡∏≤‡∏†‡∏£‡∏ì‡πå ‡∏™‡∏≤‡∏¢‡∏î‡∏ß‡∏á", "email": "65012464@up.ac.th" },
            "65012778": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏∏‡∏•‡∏ò‡∏¥‡∏î‡∏≤ ‡∏î‡∏≠‡∏ô‡∏™‡∏µ‡∏î‡∏≤", "email": "65012778@up.ac.th" },
            "65072024": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏°‡∏û‡∏π‡∏ô‡∏∏‡∏ä ‡∏ö‡∏∏‡∏ç‡πÅ‡∏£‡∏á", "email": "65072024@up.ac.th" },
            "65072025": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏¢‡∏∏‡∏î‡∏≤ ‡∏£‡∏≠‡∏î‡∏ß‡∏¥‡∏ô‡∏¥‡∏à", "email": "65072025@up.ac.th" },
            "65072034": { "name": "‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏ä‡∏ô‡∏ô‡∏ó‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ó‡∏¥‡∏°‡∏≤", "email": "65072034@up.ac.th" },
            "65072046": { "name": "‡∏ô‡∏≤‡∏¢‡∏ó‡∏£‡∏á‡∏û‡∏• ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏µ‡∏î‡∏≤", "email": "65072046@up.ac.th" },
            "65072074": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏ú‡∏≤‡∏™‡∏∏‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏û‡∏£", "email": "65072074@up.ac.th" },
            "65072081": { "name": "‡∏ô‡∏≤‡∏¢‡∏û‡∏®‡∏ß‡∏µ‡∏£‡πå ‡∏°‡∏±‡πà‡∏á‡∏™‡∏π‡∏á‡πÄ‡∏ô‡∏¥‡∏ô", "email": "65072081@up.ac.th" },
            "65072094": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ü‡∏≤‡∏î‡∏µ‡∏•‡πä‡∏∞ ‡πÅ‡∏•‡∏°‡∏±‡∏ô‡πÄ‡∏™‡πá‡∏ô", "email": "65072094@up.ac.th" },
            "65072100": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏†‡∏±‡∏™‡∏™‡∏£‡∏•‡∏≤‡∏ß‡∏±‡∏ì‡∏¢‡πå ‡πÄ‡∏¢‡πá‡∏ô‡∏ó‡∏£‡∏ß‡∏á", "email": "65072100@up.ac.th" },
            "65072131": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏£‡∏∏‡∏ï‡∏≤ ‡∏ï‡πâ‡∏≤‡∏ß‡∏û‡∏£‡∏°", "email": "65072131@up.ac.th" },
            "65072148": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏™‡∏≤‡∏ß‡∏ô‡∏µ‡∏¢‡πå ‡∏®‡∏£‡∏µ‡∏ï‡∏±‡πâ‡∏á", "email": "65072148@up.ac.th" },
            "65072157": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏£‡∏±‡∏ç‡∏ç‡∏≤ ‡∏Ñ‡∏á‡∏™‡∏°‡∏Ç‡∏≠‡∏á", "email": "65072157@up.ac.th" },
            "65072158": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏£‡∏¥‡∏™‡∏£‡∏≤ ‡∏Ñ‡∏°‡∏à‡∏£‡∏¥‡∏á", "email": "65072158@up.ac.th" },
            "65072159": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏•‡∏¥‡∏ï‡∏≤ ‡∏ô‡∏≤‡∏Ñ‡∏∞‡∏£‡∏±‡∏ï‡∏ô‡πå‡∏ß‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "email": "65072159@up.ac.th" },
            "65072170": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏¥‡∏ï‡∏¥‡∏°‡∏≤ ‡πÉ‡∏à‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", "email": "65072170@up.ac.th" },
            "65072180": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏°‡∏•‡∏£‡∏±‡∏ï‡∏ô‡πå ‡∏ó‡∏∞‡∏ô‡∏±‡∏ô‡∏ä‡∏±‡∏¢", "email": "65072180@up.ac.th" },
            "65072206": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ß‡∏ä‡∏¥‡∏£‡∏†‡∏£‡∏ì‡πå ‡πÅ‡∏õ‡∏á‡πÄ‡∏á‡∏¥‡∏ô", "email": "65072206@up.ac.th" },
            "65077015": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏Å‡∏ß‡∏•‡∏¥‡∏ô ‡∏ù‡∏±‡πâ‡∏ô‡πÉ‡∏à", "email": "65077015@up.ac.th" },
            "66023670": { "name": "‡∏ô‡∏≤‡∏¢‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå ‡∏õ‡∏•‡∏≤‡∏™‡∏∏‡∏ß‡∏£‡∏£‡∏ì", "email": "66023670@up.ac.th" },
            "66070123": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏™‡∏∏‡∏Ñ‡∏ô‡∏ò‡∏≤ ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏∏‡∏î‡∏£", "email": "66070123@up.ac.th" },
            "66072004": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏∏‡∏•‡∏ì‡∏±‡∏ê ‡∏®‡∏£‡∏µ‡∏ò‡∏á", "email": "66072004@up.ac.th" },
            "66072006": { "name": "‡∏ô‡∏≤‡∏¢‡πÄ‡∏Ç‡∏°‡∏ó‡∏±‡∏ï ‡∏Å‡∏≥‡∏£‡∏π‡∏õ", "email": "66072006@up.ac.th" },
            "66072011": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏∏‡∏ë‡∏≤‡∏ó‡∏¥‡∏û‡∏¢‡πå ‡∏ó‡∏≠‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "email": "66072011@up.ac.th" },
            "66072017": { "name": "‡∏ô‡∏≤‡∏¢‡∏ä‡∏±‡∏¢‡∏°‡∏á‡∏Ñ‡∏• ‡∏ö‡∏£‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå", "email": "66072017@up.ac.th" },
            "66072018": { "name": "‡∏ô‡∏≤‡∏¢‡∏ä‡∏π‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡πÉ‡∏à‡∏¢‡∏∑‡∏ô", "email": "66072018@up.ac.th" },
            "66072026": { "name": "‡∏ô‡∏≤‡∏¢‡∏ó‡∏¢‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏≤‡∏î‡∏≤ ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏û‡∏≤‡∏ô", "email": "66072026@up.ac.th" },
            "66072044": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ô‡∏§‡∏°‡∏• ‡∏õ‡∏£‡∏≠‡∏á‡∏î‡∏≠‡∏á", "email": "66072044@up.ac.th" },
            "66072056": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏¥‡∏¢‡∏∞‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏™‡∏≤", "email": "66072056@up.ac.th" },
            "66072075": { "name": "‡∏ô‡∏≤‡∏¢‡∏ß‡∏£‡∏°‡∏±‡∏ô ‡πÅ‡∏Å‡πà‡∏ô‡∏à‡∏≥‡∏õ‡∏≤", "email": "66072075@up.ac.th" },
            "66072078": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ß‡∏¥‡∏°‡∏•‡∏™‡∏¥‡∏£‡∏¥ ‡πÅ‡∏™‡∏á‡∏®‡∏£‡∏µ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "email": "66072078@up.ac.th" },
            "66072096": { "name": "‡∏ô‡∏≤‡∏¢‡πÄ‡∏™‡∏é‡∏ê‡∏ß‡∏∏‡∏í‡∏¥ ‡∏à‡∏¥‡∏ô‡∏≤", "email": "66072096@up.ac.th" },
            "66072099": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ù‡∏±‡∏ô ‡∏™‡∏µ‡∏û‡∏∞‡πÄ‡∏ô‡∏≤", "email": "66072099@up.ac.th" },
            "66072104": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Å‡∏°‡∏•‡∏£‡∏±‡∏ï‡∏ô‡πå ‡πÑ‡∏û‡∏£‡∏á‡∏≤‡∏°‡∏û‡∏•‡∏≠‡∏¢", "email": "66072104@up.ac.th" },
            "66072107": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Ñ‡∏≥‡∏î‡∏π‡πà ‡∏Ñ‡∏≥‡∏î‡∏µ", "email": "66072107@up.ac.th" },
            "66072108": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏¥‡∏î‡∏≤‡∏†‡∏≤ ‡∏ï‡πä‡∏∞‡∏õ‡∏±‡∏ç‡∏ç‡∏≤", "email": "66072108@up.ac.th" },
            "66072113": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ì‡∏±‡∏ê‡∏ò‡∏¢‡∏≤‡∏ô‡πå ‡∏≠‡∏∏‡πà‡∏ô‡∏ï‡∏¥‡πä‡∏ö", "email": "66072113@up.ac.th" },
            "66072116": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏≤‡∏£‡∏¥‡∏ô‡∏µ ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡πÅ‡∏Å‡πâ‡∏ß‡∏¢‡∏®", "email": "66072116@up.ac.th" },
            "66072139": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏à‡∏¥‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡πå ‡∏£‡∏±‡∏ï‡∏ô‡∏∞‡∏®‡∏¥‡∏•", "email": "66072139@up.ac.th" },
            "66072148": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ò‡∏ô‡∏†‡∏£‡∏ì‡πå ‡∏û‡∏¥‡∏°‡∏°‡∏´‡∏≤‡∏ß‡∏±‡∏ô", "email": "66072148@up.ac.th" },
            "66072174": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÇ‡∏´‡∏°‡∏≠ ‡∏•‡∏∏‡∏á‡∏õ‡∏≠", "email": "66072174@up.ac.th" },
            "66072175": { "name": "‡∏ô‡∏≤‡∏¢‡∏≠‡∏®‡∏¥‡∏£‡∏ß‡∏±‡∏ä‡∏£ ‡∏≠‡∏≥‡πÑ‡∏û‡∏ß‡∏±‡∏ä‡∏£‡∏≤‡∏Å‡∏∏‡∏•", "email": "66072175@up.ac.th" },
            "66072179": { "name": "‡∏ô‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡∏ï‡πå‡∏Å‡∏ß‡∏µ ‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡∏à‡∏±‡∏¢", "email": "66072179@up.ac.th" },
            "66202196": { "name": "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç ‡∏ô‡∏µ‡∏£‡∏∞‡πÄ‡∏ô‡∏ï‡∏£", "email": "66202196@up.ac.th" }
        };

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let currentUser = null;
        let tokenData = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(message, type = 'loading') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.className = `status-card ${type}`;
            statusEl.innerHTML = type === 'loading' ? 
                `<div class="spinner" style="margin: 0 auto 10px;"></div>${message}` : 
                message;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token ‡∏à‡∏≤‡∏Å URL
        function validateToken() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (!token) {
                showStatus('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö Token ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return false;
            }

            try {
                tokenData = JSON.parse(atob(token));
                const now = Date.now();
                
                if (!tokenData.session || !tokenData.timestamp || !tokenData.expires) {
                    throw new Error('Token format invalid');
                }
                
                if (now > tokenData.expires) {
                    showStatus('‚è∞ QR Code ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÉ‡∏´‡∏°‡πà', 'warning');
                    return false;
                }
                
                showStatus('‚úÖ Token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'success');
                document.getElementById('loginSection').style.display = 'block';
                return true;
                
            } catch (error) {
                showStatus('‚ùå Token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return false;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        async function signInWithGoogle() {
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...';
            
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡πÄ‡∏°‡∏ô email
                if (!user.email.endsWith('@up.ac.th')) {
                    showStatus('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ (@up.ac.th)', 'error');
                    await auth.signOut();
                    return;
                }
                
                currentUser = user;
                handleUserLogin(user);
                
            } catch (error) {
                console.error('Login error:', error);
                showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google';
            }
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        function handleUserLogin(user) {
            const studentId = user.email.split('@')[0];
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!studentList[studentId]) {
                showStatus('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ', 'error');
                return;
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            document.getElementById('userName').textContent = studentList[studentId].name;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('studentId').textContent = studentId;
            
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('userSection').style.display = 'block';
            
            showStatus('‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠', 'success');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠
        async function performCheckin() {
            if (!currentUser || !tokenData) {
                showStatus('‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            const checkinBtn = document.getElementById('checkinBtn');
            checkinBtn.disabled = true;
            checkinBtn.innerHTML = '<div class="spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            
            try {
                const studentId = currentUser.email.split('@')[0];
                const studentData = studentList[studentId];
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Firestore
                const docRef = doc(db, 'checkins', tokenData.session, 'students', studentId);
                
                await setDoc(docRef, {
                    studentId: studentId,
                    name: studentData.name,
                    email: currentUser.email,
                    checkinTime: serverTimestamp(),
                    tokenTimestamp: tokenData.timestamp,
                    userAgent: navigator.userAgent
                });
                
                showStatus('üéâ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                checkinBtn.style.display = 'none';
                
            } catch (error) {
                console.error('Checkin error:', error);
                showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
                checkinBtn.disabled = false;
                checkinBtn.innerHTML = '‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô';
            }
        }

        // Event Listeners
        document.getElementById('loginBtn').addEventListener('click', signInWithGoogle);
        document.getElementById('checkinBtn').addEventListener('click', performCheckin);

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        onAuthStateChanged(auth, (user) => {
            if (user && user.email.endsWith('@up.ac.th')) {
                currentUser = user;
                handleUserLogin(user);
            }
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        document.addEventListener('DOMContentLoaded', function() {
            validateToken();
        });
    </script>
</body>
</html>
